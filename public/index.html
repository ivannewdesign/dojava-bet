<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dojava.bet - Live Sports Predictions</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: #0a0e27;
      color: #fff;
      line-height: 1.6;
    }
    
    /* HEADER */
    .header {
      background: #13193f;
      padding: 20px 0;
      border-bottom: 2px solid #4361ee;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 28px;
      font-weight: 800;
      color: #4361ee;
      text-decoration: none;
    }
    
    .nav {
      display: flex;
      gap: 30px;
    }
    
    .nav a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s;
    }
    
    .nav a:hover {
      color: #4361ee;
    }
    
    /* SPORT TABS */
    .sport-tabs {
      background: #0a0e27;
      padding: 20px;
      display: flex;
      gap: 10px;
      justify-content: center;
      border-bottom: 1px solid #1a2151;
    }
    
    .sport-tab {
      padding: 12px 30px;
      background: #13193f;
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .sport-tab:hover {
      border-color: #4361ee;
      background: #1a2151;
    }
    
    .sport-tab.active {
      background: #4361ee;
      border-color: #4361ee;
    }
    
    /* MAIN LAYOUT */
    .main-layout {
      display: flex;
      max-width: 1600px;
      margin: 0 auto;
      min-height: calc(100vh - 200px);
    }
    
    /* SIDEBAR */
    .sidebar {
      width: 280px;
      background: #13193f;
      border-right: 1px solid #1a2151;
      overflow-y: auto;
      position: sticky;
      top: 140px;
      height: calc(100vh - 140px);
    }
    
    .sidebar-section {
      padding: 20px;
      border-bottom: 1px solid #1a2151;
    }
    
    .sidebar-title {
      font-size: 12px;
      font-weight: 700;
      color: #666;
      text-transform: uppercase;
      margin-bottom: 15px;
      letter-spacing: 1px;
    }
    
    .league-item {
      padding: 10px;
      margin-bottom: 5px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      color: #ccc;
    }
    
    .league-item:hover {
      background: #1a2151;
      color: #fff;
    }
    
    .league-item.active {
      background: #4361ee;
      color: #fff;
    }
    
    .league-count {
      float: right;
      background: #1a2151;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      color: #888;
    }
    
    /* CONTENT */
    .content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }
    
    /* LEAGUE SECTION */
    .league-section {
      margin-bottom: 40px;
    }
    
    .league-header {
      background: #13193f;
      padding: 15px 20px;
      border-radius: 8px 8px 0 0;
      font-weight: 700;
      font-size: 15px;
      color: #fff;
      border-left: 4px solid #4361ee;
      margin-bottom: 10px;
    }
    
    .league-country {
      color: #888;
      font-size: 13px;
      font-weight: 600;
      margin-right: 10px;
    }
    
    /* MATCH CARD */
    .match-card {
      background: #13193f;
      border: 1px solid #1a2151;
      border-radius: 8px;
      padding: 15px 20px;
      margin-bottom: 10px;
      transition: all 0.3s;
      cursor: pointer;
    }
    
    .match-card:hover {
      border-color: #4361ee;
      transform: translateX(5px);
    }
    
    .match-header {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 10px;
    }
    
    .match-time {
      background: #4361ee;
      color: white;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
    }
    
    .match-time.live {
      background: #f72585;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .match-teams {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .team {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .team-name {
      font-size: 15px;
      font-weight: 600;
    }
    
    .team-score {
      font-size: 22px;
      font-weight: 800;
      color: #4361ee;
      min-width: 30px;
      text-align: center;
    }
    
    .match-vs {
      padding: 0 20px;
      font-size: 16px;
      font-weight: 700;
      color: #666;
    }
    
    .team-right {
      flex-direction: row-reverse;
    }
    
    /* LOADING */
    .loading {
      text-align: center;
      padding: 60px;
      font-size: 18px;
      color: #666;
    }
    
    .spinner {
      border: 4px solid rgba(67, 97, 238, 0.2);
      border-top: 4px solid #4361ee;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* NO MATCHES */
    .no-matches {
      text-align: center;
      padding: 80px 20px;
      color: #666;
    }
    
    /* RESPONSIVE */
    @media (max-width: 1024px) {
      .sidebar {
        display: none;
      }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="header-content">
      <a href="/" class="logo">DOJAVA.BET</a>
      <nav class="nav">
        <a href="#live">Live</a>
        <a href="#leagues">Leagues</a>
        <a href="#premium">Premium</a>
      </nav>
    </div>
  </header>

  <!-- SPORT TABS -->
  <div class="sport-tabs">
    <div class="sport-tab active" data-sport="football">
      <span>‚öΩ</span> Football
    </div>
    <div class="sport-tab" data-sport="basketball">
      <span>üèÄ</span> Basketball
    </div>
    <div class="sport-tab" data-sport="tennis">
      <span>üéæ</span> Tennis
    </div>
  </div>

  <!-- MAIN LAYOUT -->
  <div class="main-layout">
    
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="loading">
        <div class="spinner"></div>
        Loading leagues...
      </div>
    </aside>

    <!-- CONTENT -->
    <main class="content" id="content">
      <div class="loading">
        <div class="spinner"></div>
        Loading matches...
      </div>
    </main>

  </div>

  <script>
    // STATE
    let allMatches = {
      football: [],
      basketball: [],
      tennis: []
    };
    
    let currentSport = 'football';
    let selectedLeague = null;
    
    // LOAD MATCHES FROM API
    async function loadMatches() {
      try {
        const response = await fetch('/api/matches');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        console.log('‚úÖ Data loaded:', data);
        
        allMatches = {
          football: data.football || [],
          basketball: data.basketball || [],
          tennis: data.tennis || []
        };
        
        renderSidebar();
        renderMatches();
        
      } catch (error) {
        console.error('‚ùå Error loading matches:', error);
        showError();
      }
    }
    
    // RENDER SIDEBAR
    function renderSidebar() {
      const sidebar = document.getElementById('sidebar');
      const matches = allMatches[currentSport];
      
      if (!matches || matches.length === 0) {
        sidebar.innerHTML = '<div class="loading">No leagues</div>';
        return;
      }
      
      // Extract unique leagues with counts
      const leagueMap = {};
      matches.forEach(match => {
        const leagueName = match.tournament_name || 'Unknown League';
        if (!leagueMap[leagueName]) {
          leagueMap[leagueName] = {
            name: leagueName,
            country: match.country_name || '',
            count: 0
          };
        }
        leagueMap[leagueName].count++;
      });
      
      const leagues = Object.values(leagueMap).sort((a, b) => a.name.localeCompare(b.name));
      
      const html = `
        <div class="sidebar-section">
          <div class="sidebar-title">All Leagues (${leagues.length})</div>
          <div class="league-item" onclick="selectLeague(null)" ${!selectedLeague ? 'class="league-item active"' : ''}>
            <strong>All Matches</strong>
            <span class="league-count">${matches.length}</span>
          </div>
          ${leagues.map(league => `
            <div class="league-item ${selectedLeague === league.name ? 'active' : ''}" onclick="selectLeague('${league.name.replace(/'/g, "\\'")}')">
              ${league.name}
              <span class="league-count">${league.count}</span>
            </div>
          `).join('')}
        </div>
      `;
      
      sidebar.innerHTML = html;
    }
    
    // SELECT LEAGUE
    function selectLeague(leagueName) {
      selectedLeague = leagueName;
      renderSidebar();
      renderMatches();
    }
    
    // RENDER MATCHES
    function renderMatches() {
      const content = document.getElementById('content');
      let matches = allMatches[currentSport];
      
      if (!matches || matches.length === 0) {
        content.innerHTML = `
          <div class="no-matches">
            <h2>No matches available</h2>
            <p>Check back soon for ${currentSport} matches!</p>
          </div>
        `;
        return;
      }
      
      // Filter by selected league
      if (selectedLeague) {
        matches = matches.filter(m => m.tournament_name === selectedLeague);
      }
      
      // Group by league
      const grouped = {};
      matches.forEach(match => {
        const leagueName = match.tournament_name || 'Unknown League';
        if (!grouped[leagueName]) {
          grouped[leagueName] = {
            name: leagueName,
            country: match.country_name || '',
            matches: []
          };
        }
        grouped[leagueName].matches.push(match);
      });
      
      const leagues = Object.values(grouped);
      
      const html = leagues.map(league => `
        <div class="league-section">
          <div class="league-header">
            <span class="league-country">${league.country}:</span>
            ${league.name}
          </div>
          ${league.matches.map(match => createMatchCard(match)).join('')}
        </div>
      `).join('');
      
      content.innerHTML = html || '<div class="no-matches"><h2>No matches found</h2></div>';
    }
    
    // CREATE MATCH CARD
    function createMatchCard(match) {
      const homeTeam = match.home_team?.name || 'Home';
      const awayTeam = match.away_team?.name || 'Away';
      const homeScore = match.home_team?.score ?? '-';
      const awayScore = match.away_team?.score ?? '-';
      
      let status = '';
      let statusClass = '';
      
      if (match.stage) {
        const stage = match.stage.toString();
        if (!isNaN(stage) && stage !== '0') {
          status = stage + "'";
          statusClass = 'live';
        } else if (stage === 'Finished') {
          status = 'FT';
        } else if (stage === 'Half Time' || stage === 'HT') {
          status = 'HT';
          statusClass = 'live';
        } else if (match.timestamp) {
          const matchDate = new Date(match.timestamp * 1000);
          status = matchDate.toLocaleTimeString('hr-HR', { hour: '2-digit', minute: '2-digit' });
        } else {
          status = stage;
        }
      } else if (match.timestamp) {
        const matchDate = new Date(match.timestamp * 1000);
        status = matchDate.toLocaleTimeString('hr-HR', { hour: '2-digit', minute: '2-digit' });
      }
      
      return `
        <div class="match-card">
          <div class="match-header">
            <div class="match-time ${statusClass}">${status}</div>
          </div>
          <div class="match-teams">
            <div class="team">
              <div class="team-name">${homeTeam}</div>
              <div class="team-score">${homeScore}</div>
            </div>
            <div class="match-vs">-</div>
            <div class="team team-right">
              <div class="team-score">${awayScore}</div>
              <div class="team-name">${awayTeam}</div>
            </div>
          </div>
        </div>
      `;
    }
    
    // SHOW ERROR
    function showError() {
      document.getElementById('content').innerHTML = `
        <div class="no-matches">
          <h2>Failed to load matches</h2>
          <p>Please refresh the page or try again later.</p>
        </div>
      `;
    }
    
    // SPORT TAB CLICK
    document.querySelectorAll('.sport-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.sport-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentSport = tab.dataset.sport;
        selectedLeague = null;
        renderSidebar();
        renderMatches();
      });
    });
    
    // INIT
    loadMatches();
    
    // AUTO-REFRESH every 3 minutes
    setInterval(loadMatches, 180000);
  </script>

</body>
</html>
